<div class="row row-cards">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Configuración formulario</h3>
      </div>
      <div class="card-body border-bottom py-3">
        <div class="d-flex">
          <button
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#modal-report"
          >
            <i class="ti ti-plus me-1"></i>Configuración
          </button>
          <div class="ms-auto text-muted">
            <div class="input-icon">
              <input
                #busquedaInput
                type="text"
                [(ngModel)]="filtro"
                class="form-control form-control-rounded"
                placeholder="Buscar"
              />
              <span class="input-icon-addon">
                <i class="ti ti-search"></i>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table card-table table-vcenter text-nowrap datatable">
          <thead>
            <tr>
              <th class="w-1">ID</th>
              <th>Correo Electronico</th>
              <th>Nombre del formulario</th>
              <th>Nombre de la hoja</th>
              <th class="text-center" style="width: 7%">Acciones</th>
            </tr>
          </thead>
          <tbody class="table-tbody">
            <tr
              *ngFor="
                let formularios of filtrarResultados()
                  | paginate
                    : { itemsPerPage: itemsPerPage, currentPage: currentPage };
                let i = index
              "
            >
              <td>{{ i + 1 }}</td>
              <td>{{ formularios.clientEmail }}</td>
              <td>{{ formularios.formName }}</td>
              <td>{{ formularios.sheetName }}</td>
              <td>
                <div class="d-flex justify-content-between">
                  <button class="btn btn-warning btn-icon btn-sm">
                    <i
                      class="ti ti-edit"
                      data-bs-toggle="modal"
                      data-bs-target="#modal-report-edit"
                    ></i>
                  </button>
                  <button
                    class="btn btn-danger btn-icon btn-sm"
                    style="margin-left: 5px; margin-right: 5px"
                  >
                    <i class="ti ti-eraser"></i>
                  </button>
                  <button
                    class="btn btn-primary btn-icon btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#modal-info"
                    (click)="abrirModal(formularios)"
                  >
                    <i class="ti ti-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pagination-and-items-per-page" style="margin-bottom: 0px">
        <div class="items-per-page">
          <label for="itemsPerPage">Elementos por página:</label>
          <select
            id="itemsPerPage"
            [(ngModel)]="itemsPerPage"
            style="margin-left: 5px"
          >
            <option *ngFor="let option of itemsPerPageOptions" [value]="option">
              {{ option }}
            </option>
          </select>
        </div>

        <div class="pagination-container">
          <pagination-controls
            (pageChange)="currentPage = $event"
          ></pagination-controls>
        </div>
      </div>
    </div>
  </div>
</div>

<!--MODAL AGREGAR CONFIGURACIÓN-->
<div
  class="modal modal-blur fade"
  id="modal-report"
  tabindex="-1"
  role="dialog"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Agregar configuración de formulario.</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <!-- Inicio del formulario -->
      <form
        [formGroup]="configGoogleFormFormGroup"
        (ngSubmit)="guardarUsuario()"
      >
        <div class="modal-body">
          <div class="row">
            <div class="col-lg-12">
              <div class="mb-3">
                <label class="form-label">Nombre del formulario</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="formName"
                  [class.is-invalid]="marcarFormNameFrontTocado()"
                />
                <div
                  *ngIf="
                    formNameFrontTocado &&
                    configGoogleFormFormGroup
                      .get('formNameFront')
                      ?.hasError('required')
                  "
                  class="error-message"
                ></div>
              </div>
            </div>
          </div>
          <br />
          <div class="row">
            <div class="col-lg-12">
              <div class="mb-3">
                <label class="form-label">ID de Google Form</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="googleFormId"
                  [class.is-invalid]="marcarGoogleFormIdFrontTocado()"
                />
                <div
                  *ngIf="
                    googleFormIdFrontTocado &&
                    configGoogleFormFormGroup
                      .get('googleFormIdFront')
                      ?.hasError('required')
                  "
                  class="error-message"
                ></div>
              </div>
            </div>
          </div>
          <br />
          <div class="row">
            <div class="col-lg-12">
              <div class="mb-3">
                <label class="form-label">ID de la Hoja de Cálculo</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="spreadsheetId"
                  [class.is-invalid]="marcarSpreadsheetIdFrontTocado()"
                />
                <div
                  *ngIf="
                    spreadsheetIdFrontTocado &&
                    configGoogleFormFormGroup
                      .get('spreadsheetIdFront')
                      ?.hasError('required')
                  "
                  class="error-message"
                ></div>
              </div>
            </div>
          </div>
          <br />

          <div class="row">
            <div class="col-lg-12">
              <div class="mb-3">
                <label class="form-label">Nombre de la Hoja de Cálculo</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="sheetName"
                  [class.is-invalid]="marcarSheetNameFrontTocado()"
                />
                <div
                  *ngIf="
                    sheetNameFrontTocado &&
                    configGoogleFormFormGroup
                      .get('sheetNameFront')
                      ?.hasError('required')
                  "
                  class="error-message"
                ></div>
              </div>
            </div>
          </div>
          <br />

          <div class="row">
            <div class="col-md-12">
              <label class="form-label">Credenciales JSON</label>
              <div class="card">
                <div class="card-body">
                  <input
                    type="file"
                    class="form-control"
                    id="credencialesJSONInput"
                    accept=".json"
                    (change)="onFileChange($event)"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-link link-secondary"
            data-bs-dismiss="modal"
            (click)="resetForm()"
          >
            Limpiar
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="!configGoogleFormFormGroup.valid"
          >
            Crear nuevo usuario
          </button>
        </div>
        <!-- Fin del formulario -->
      </form>
    </div>
  </div>

  <!--FIN MODAL-->
</div>

<!-- MODAL PARA VER INFORMACIÓN DE LA CONFIGURACIÓN -->
<div
  class="modal fade"
  id="modal-info"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title" id="exampleModalLabel">
          Información del formulario
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!-- Inicio -->

      <div class="modal-body" style="background-color: #f6f8fb">
        <div class="row row-cards">
          <div class="col-md-4 col-lg-12">
            <div class="card card-borderless">
              <div class="card-body">
                <h2 class="card-title">
                  ID del formulario: {{ formularioSeleccionado?.formularioId }}
                </h2>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-12">
            <div class="card card-borderless">
              <div class="card-body">
                <h2 class="card-title">
                  Nombre: {{ formularioSeleccionado?.formName }}
                </h2>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-12">
            <div class="card card-borderless">
              <div class="card-body">
                <h2 class="card-title">
                  ID de Google Form: {{ formularioSeleccionado?.googleFormId }}
                </h2>
              </div>
            </div>
          </div>

          <div class="col-md-4 col-lg-12">
            <div class="card card-borderless">
              <div class="card-body">
                <h2 class="card-title">
                  Nombre de la hoja de calculo:
                  {{ formularioSeleccionado?.sheetName }}
                </h2>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-lg-12">
            <div class="card card-borderless">
              <div class="card-body">
                <h2 class="card-title">
                  ID de la hoja de Cálculo:
                  {{ formularioSeleccionado?.spreadsheetId }}
                </h2>
              </div>
            </div>
          </div>
        </div>
        <br />
        <div class="row row-cards">
          <div class="col-md-4 col-lg-12">
            <div class="card card-borderless">
              <div class="card-body">
                <h2 class="card-title">
                  ID del proyecto: {{ formularioSeleccionado?.projectId }}
                </h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
