<div class="row row-cards">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <div class="header-left">
                    <h3 class="card-title" style="width: 105px;">Candidatos</h3>
                </div>
                <div class="header-right">
                    <button class="revisar-button" (click)="enviarGoogleFormIds()">Revisar respuestas</button>
                </div>
            </div>

            <div class="card-body border-bottom py-3">
                <div class="d-flex">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-report" (click)="handleChangeAdd()">
                      <i class="ti ti-plus me-1"></i>Agregar Candidato
                    </button>
                    <div class="ms-auto text-muted">
                        <div class="input-icon">
                            <input #busquedaInput type="text" [(ngModel)]="filtro" class="form-control form-control-rounded" placeholder="Buscar" />
                            <span class="input-icon-addon">
                <i class="ti ti-search"></i>
              </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table card-table table-vcenter text-nowrap datatable">
                    <thead>
                        <tr>
                            <th>Nombre del (la) candidato (a)</th>
                            <th>Apellido materno</th>
                            <th>Apellido paterno</th>
                            <th>Cargo</th>
                            <th>Agrupación política</th>
                            <th>Respuestas de formularios</th>
                            <th class="text-center" style="width: 7%">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="table-tbody">
                        <tr *ngFor="let candidato of candidatos" class="align-items-center">
                            <td class="justify-content-center">{{ candidato.nombre }}</td>
                            <td class="justify-content-center">{{ candidato.apellidoPaterno }}</td>
                            <td class="justify-content-center">{{ candidato.apellidoMaterno }}</td>
                            <td class="justify-content-center">{{ getNombreCargo(candidato.cargoId) }}</td>
                            <td class="justify-content-center">{{ getNombreAgrupacion(candidato.candidaturaId) }}</td>
                            <td class="justify-content-center">
                                <div class="d-flex justify-content-center">
                                    <button class="btn btn-primary btn-icon btn-sm" data-bs-toggle="modal" data-bs-target="#myModaledit" (click)="abrirModal(candidato)">
                                      <i class="ti ti-eye"></i>
                                  </button>
                                </div>
                            </td>

                            <td class="justify-content-center">
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-warning btn-icon btn-sm">
                                      <i class="ti ti-edit" data-bs-toggle="modal" data-bs-target="#modal-report"></i>
                                  </button>
                                    <button class="btn btn-danger btn-icon btn-sm" style="margin-left: 5px; margin-right: 5px">
                                      <i class="ti ti-eraser"></i>
                                  </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--MODAL AGREGAR CANDIDATO-->
<div class="modal modal-blur fade" id="modal-report" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    {{ isModalAdd ? "Agregar" : "Actualizar" }} Candidato
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" #closebutton></button>
            </div>

            <form [formGroup]="userForm" (ngSubmit)="submitUsuario()">
                <div class="modal-body">
                    <!-- Inicio del formulario -->
                    <div class="card">
                        <div class="ribbon ribbon-top bg-green">
                            <i class="ti ti-man"></i> </div>
                        <div class="card-header">
                            <h3 class="card-title">INFORMACIÓN GENERAL</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="mb-3">
                                        <label class="form-label">Nombre</label>
                                        <input type="text" class="form-control" formControlName="nombrePropietario" />
                                        <div *ngIf="userForm.get('nombrePropietario')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('nombrePropietario')?.hasError('required')">
                                                El nombre es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-4">
                                        <label class="form-label">Sobrenombre</label>
                                        <input type="text" class="form-control" formControlName="sobrenombrePropietario" />
                                        <div *ngIf="userForm.get('sobrenombrePropietario')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('sobrenombrePropietario')?.hasError('required')">
                                                El sobrenombre es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Género</label>
                                        <div>
                                            <label *ngFor="let generoItem of genero" class="form-check">
                                        <input class="form-check-input" type="radio" [value]="generoItem.generoId" formControlName="generoId">
                                        <span class="form-check-label">{{ generoItem.nombreGenero }}</span>
                                      </label>
                                        </div>
                                        <div *ngIf="userForm.get('generoId')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('generoId')?.hasError('required')">
                                                El género es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Nombre del suplente</label>
                                        <input type="text" class="form-control" formControlName="nombreSuplente" />
                                        <div *ngIf="userForm.get('nombreSuplente')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('nombreSuplente')?.hasError('required')">
                                                El nombre es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Correo Electrónico</label>
                                        <input type="text" class="form-control" formControlName="email" />
                                        <div *ngIf="userForm.get('email')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('email')?.hasError('required')">
                                                El correo electrónico es requerido
                                            </div>
                                            <div *ngIf="userForm.get('email')?.hasError('email')">
                                                Ingresa una dirección de correo electrónico válida
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Fecha de nacimiento</label>
                                        <input type="date" class="form-control" formControlName="fechaNacimiento" />
                                        <div *ngIf="userForm.get('fechaNacimiento')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('fechaNacimiento')?.hasError('required')">
                                                La fecha de nacimiento es requerida
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Dirección de casa de campaña</label>
                                        <input type="text" class="form-control" formControlName="direccionCasaCampaña" />
                                        <div *ngIf="userForm.get('direccionCasaCampaña')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('direccionCasaCampaña')?.hasError('required')">
                                                La dirección es obligatoria
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Télefono Público</label>
                                        <input type="tel" class="form-control" formControlName="telefonoPublico" />
                                        <div *ngIf="userForm.get('telefonoPublico')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('telefonoPublico')?.hasError('required')">
                                                El número de télefono es requerido
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Página Web</label>
                                        <input type="text" class="form-control" formControlName="paginaWeb" />
                                        <div *ngIf="userForm.get('paginaWeb')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('paginaWeb')?.hasError('required')">
                                                La páqina web es obligatoria
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br> <br>
                    <div class="card">
                        <div class="ribbon ribbon-top bg-blue">
                            <i class="ti ti-map-2"></i> </div>
                        <div class="card-header">
                            <h3 class="card-title">INFORMACIÓN REFERENTE A LA DEMARCACIÓN</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <label class="form-label">Cargo</label>
                                        <select class="form-select" formControlName="cargoId">
                              <option value="null">Selecciona un cargo...</option>
                              <option *ngFor="let cargoItem of cargos" [value]="cargoItem.cargoId">{{ cargoItem.nombreCargo }}</option>
                            </select>
                                        <div *ngIf="userForm.get('cargoId')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('cargoId')?.hasError('required')">
                                                El cargo es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <label class="form-label">Estado</label>
                                        <select class="form-select" formControlName="estadoId">
                              <option value="null">Selecciona un estado...</option>
                              <option *ngFor="let estadoItem of estados" [value]="estadoItem.estadoId">{{ estadoItem.nombreEstado }}</option>
                            </select>
                                        <div *ngIf="userForm.get('estadoId')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('estadoId')?.hasError('required')">
                                                El estado es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4">
                                    <div class="mb-3">
                                        <label class="form-label">Organización Política</label>
                                        <select class="form-select" formControlName="candidaturaId">
                              <option value="null">Selecciona una Organización...</option>
                              <option *ngFor="let candidaturaItem of candidaturas" [value]="candidaturaItem.tipoCandidaturaId">{{ candidaturaItem.nombreTipoCandidatura }}</option>
                            </select>
                                        <div *ngIf="userForm.get('candidaturaId')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('candidaturaId')?.hasError('required')">
                                                La organización es obligatoria
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br> <br>
                    <div class="card">
                        <div class="ribbon ribbon-top bg-red">
                            <i class="ti ti-brand-facebook"></i> </div>
                        <div class="card-header">
                            <h3 class="card-title">REDES SOCIALES</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Facebook</label>
                                        <input type="tel" class="form-control" formControlName="facebook" />
                                        <div *ngIf="userForm.get('facebook')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('facebook')?.hasError('required')">
                                                El link es requerido
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Twitter</label>
                                        <input type="text" class="form-control" formControlName="twitter" />
                                        <div *ngIf="userForm.get('twitter')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('twitter')?.hasError('required')">
                                                El link es requerido
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">Instagram</label>
                                        <input type="tel" class="form-control" formControlName="instagram" />
                                        <div *ngIf="userForm.get('instagram')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('instagram')?.hasError('required')">
                                                El link es requerido
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="mb-3">
                                        <label class="form-label">TikTok</label>
                                        <input type="text" class="form-control" formControlName="tiktok" />
                                        <div *ngIf="userForm.get('tiktok')?.touched" class="error-message">
                                            <div *ngIf="userForm.get('tiktok')?.hasError('required')">
                                                El link es requerido
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br> <br>
                    <div class="card">
                        <div class="ribbon ribbon-top bg-purple">
                            <i class="ti ti-camera-plus"></i> </div>
                        <div class="card-header">
                            <h3 class="card-title">IMAGEN DEL CANDIDATO</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12 d-flex align-items-center justify-content-center">
                                    <div class="mb-1 text-center">
                                        <!-- Campo de Subir Imagen -->
                                        <div class="form-group">
                                            <label for="imagen" class="img-thumbnail" id="imagen-label" *ngIf="!previewImage">
                                        <br>
                                        <img src="assets/images/placeholderimage.png" alt="Subir imagen" style="width: 200px;">
                                        <input type="file" class="form-control-file custom-file-input" id="imagen" (change)="onImageChange($event)" style="display: none;">
                                    </label>
                                        </div>
                                        <br>
                                        <!-- Texto para seleccionar imagen -->
                                        <label class="form-label" *ngIf="!previewImage">Haz clic aquí para seleccionar una imagen desde tu dispositivo</label>

                                        <!-- Vista previa de la imagen -->
                                        <div *ngIf="previewImage" class="mt-3">
                                            <img [src]="previewImage" class="img-thumbnail" alt="Vista previa de la imagen" style="width: 200px;">
                                            <br>
                                            <label>Imagen seleccionada:</label>
                                            <br><br>
                                            <button class="btn btn-danger mt-2" *ngIf="previewImage" (click)="eliminarImagen()">Eliminar Imagen</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Fin del formulario -->
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" [disabled]="!userForm.valid">
              {{ isModalAdd ? "Agregar" : "Actualizar" }}
            </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--FIN MODAL-->
